# Doppler Gatsby Cloud Secrets Sync

Proof of concept using Doppler to supply secrets in local development plus continuos secrets sync to Gatsby Cloud.

## Setup

Install the Gatsby CLI:

```sh
npm install -g gatsby-cli
```

Create the Doppler project, then the Gatsby Cloud Site ID and your Gatsby Cloud authorization bearer token:

```sh
./bin/create-doppler-project.sh
```

Initialize the Gatsby starter template with customizations that load the site title and description from Doppler injected environment variables:

```sh
./bin/gatsby-starter-init.sh
```

## Local development

To run the Gatsby development server using an ephemeral .env file generated by the Doppler CLI:

```sh
npm run develop
```

## Gatsby Cloud Secrets Sync

To automatically sync secrets from Doppler to Gatsby Cloud when updated in Doppler, run:

```sh
node src/sync-doppler-secrets.js
```

To fetch the build and preview environment variables from Gatsby Cloud:

```sh
node src/fetch-gatsby-env-vars.js
```

To delete all build and preview environment variables from Gatsby Cloud (for testing):

```sh
node src/clear-gatsby-secrets.js
```
